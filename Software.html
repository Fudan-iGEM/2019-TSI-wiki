<script src="/jquery-1.11.3.min.js"></script>
<html lang="en">
<!-- {{Fudan-TSI}}
This html document is created by Tian Huang for Team Fudan iGEM 2018.
We make it compatible on laptop and mobile devices by using Materialize 1.0.0-rc.2.
-->
<!-- LC check on 2018-10-25 -->
<head>
    <meta charset="UTF-8">

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/Template Fudan-css.css" />

    <!-- Font-awesome icons 4.7.0 -->
    <link rel="stylesheet" href="/Template local-font-awesome.css" />

    <!-- Materialize 1.0.0-rc.2 (Material Design like) -->
    <link rel="stylesheet" href="/Template materialize.css">

    <!-- Clear default CSS settings; CSS reset -->
    <style>
        *{margin: 0;padding: 0;list-style: none;}
        /* via: https://blog.csdn.net/weixin_41014370/article/details/79523637 */

        /** 清除内外边距 **/
        body, h1, h3, h3, h4, h5, h6, hr, p, blockquote, /* structural elements 结构元素 */
        dl, dt, dd, ul, ol, li, /* list elements 列表元素 */
        pre, /* text formatting elements 文本格式元素 */
        form, fieldset, legend, button, input, textarea, /* form elements 表单元素 */
        th, td /* table elements 表格元素 */ {
            margin: 0;
            padding: 0;
        }

        /** 设置默认字体 **/

        /* @@@@ h1, h3, h3, h4, h5, h6 { font-size: 100%; }*/
        address, cite, dfn, em, var { font-style: normal; } /* 将斜体扶正 */
        code, kbd, pre, samp { font-family: courier new, courier, monospace; } /* 统一等宽字体 */
        /* @@@@ small { font-size: 12px; } /* 小于 12px 的中文很难阅读，让 small 正常化 */

        /** 重置列表元素 **/
        ul, ol { list-style: none; }

        /** 重置文本格式元素 **/
        a { text-decoration: none; }
        a:hover { text-decoration: underline; }


        /** 重置表单元素 **/
        legend { color: #000; } /* for ie6 */
        fieldset, img { border: 0; } /* img 搭车：让链接里的 img 无边框 */
        button, input, select, textarea { font-size: 100%; } /* 使得表单元素在 ie 下能继承字体大小 */
        /* 注：optgroup 无法扶正 */

        /** 重置表格元素 **/
        table { border-collapse: collapse; border-spacing: 0; }

#FudanBody .imgNoM img{
    width:100%; }
#FudanBody .imgNoM{
    text-align:center; }
.Off {display: none !important}
    </style>
    <title>2019 Team:Fudan-TSI Software</title>
</head>

<body>
<!-- Fudan div at igem.org -->
<div id="FudanWrapper" class="black"><div id="FudanBody" class="black">
        <header>
            <!-- empty bar -->
            <div id="emptyBar" style="position:relative;width: 100%;"></div>

            <!-- Navigation bar 2019-9-15 -->
            <nav id="topNav" class="black z-depth-0_5">
                <div class="nav-wrapper">
                    <div id="teamLogo" class="brand-logo">
                        <a href="/Team:Fudan-TSI" target="_self"><img alt="2019 team logo" src="https://2019.igem.org/wiki/images/d/d3/T--Fudan-TSI--HomepageLogo.gif"></a>
                    </div>
                    <ul id="nav-mobile" class="right orangeBorder">
                        <li>
                            <a id="navList" data-target="slide-out" class="waves-effect waves-light sidenav-trigger right">
                                <i class="fa fa-navicon" style="font-size:24px"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            <!-- Dropdown and List elements in navigation bar -->
            <!-- Slide-out navigator contents 2019-9-15 -->
            <ul id="slide-out" class="sidenav">
                <li style="padding: 0"><div class="sidenavBanner">
                    <div class="background">
                    </div>
                    <p class="flow-text" style="width:100%;text-align:center"><span class="white-text">Software</span></p>
                </div></li>
                <li>
                    <ul class="collapsible expandable">
                        <li><span class="pageSidebar">Team: Fudan-TSI</span></li>
<li><div class="collapsible-header"><span class="pageSidebar">Project</span></div>
    <div class="collapsible-body"><ul>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Description">Background</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Design">Design</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Experiments">Experiments</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Judging">Judging</a></li>
    </ul></div>
</li>
<li><div class="collapsible-header"><span class="pageSidebar">Results</span></div>
    <div class="collapsible-body"><ul>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Results#ReverseTranscription">Reverse Transcription</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Results#Recombination">Recombination</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Demonstrate">Demonstration</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Measurement">Measurement</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Notebook">Notebook</a></li>
    </ul></div>
</li>
<li><div class="collapsible-header active"><span class="pageSidebar">Model</span></div>
    <div class="collapsible-body"><ul>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Model">Modeling</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Software">Software</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Hardware">Hardware</a></li>
    </ul></div>
</li>
<li><div class="collapsible-header"><span class="pageSidebar">Parts</span></div>
    <div class="collapsible-body"><ul>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Basic_Part">Basic parts</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Composite_Part">Composite parts</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Improve">Improved parts</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Parts#PartCollection">Part collection</a></li>
    </ul></div>
</li>
<li><div class="collapsible-header"><span class="pageSidebar">Outreach</span></div>
    <div class="collapsible-body"><ul>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Public_Engagement">Education &amp; Public engagement</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Human_Practices#IntegratedHumanPractice">Integrated human practice</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Collaborations">Collaborations</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Safety">Safety</a></li>
    </ul></div>
</li>
<li><div class="collapsible-header"><span class="pageSidebar">Team</span></div>
    <div class="collapsible-body"><ul>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Team">Members</a></li>
        <li><a class="pageSidebar" href="/Team:Fudan-TSI/Attributions">Attributions</a></li>
        <li><a class="pageSidebar" href="http://2018.igem.org/Team:Fudan/Heritage" target=_blank>Heritage</a></li>
    </ul></div>
</li>
                    </ul><!-- .expandable -->
                </li>
                <li><div class="placeHolder"></div></li>
            </ul>
        </header>

        <div id="pageContent" style="">


            <div id="contentBanner" class="figureBanner"><!-- orangeBg -->
                <div class="row">
                    <div class="col s12 hide-on-med-and-up">
                        <h4>Software</h4>
                        <p class="flow-text">...</p>
                    </div>
                </div>
                <div id="figureBannerTitle" class="hide-on-small-only">
                    <h1>Software</h1>
                    <p class="flow-text">...</p>
                </div>
                <div class="hide-on-small-only">
                    <img src="http://2018.igem.org/wiki/images/2/26/T--Fudan--title_software.jpg">
                    <svg width="10" height="10" xmlns="http://www.w3.org/2000/svg" style="position:absolute; left:0;top:0; width: 4%;height: 100%;">
                        <defs>
                            <linearGradient y2="0%" x2="100%" y1="0%" x1="0%" id="blackgraleft">
                                <stop stop-color="rgb(0,0,0)" stop-opacity="1" offset="0%"/>
                                <stop stop-color="rgb(0,0,0)" stop-opacity="0" offset="100%"/>
                            </linearGradient>
                        </defs>
                        <g>
                            <rect id="svg_1" fill="url(#blackgraleft)" height="100%" width="100%"/>
                        </g>
                    </svg>
                    <svg width="10" height="10" xmlns="http://www.w3.org/2000/svg" style="position:absolute; right:0;top:0; width: 4%;height: 100%;">
                        <defs>
                            <linearGradient y2="0%" x2="100%" y1="0%" x1="0%" id="blackgraright">
                                <stop stop-color="rgb(0,0,0)" stop-opacity="0" offset="0%"/>
                                <stop stop-color="rgb(0,0,0)" stop-opacity="1" offset="100%"/>
                            </linearGradient>
                        </defs>
                        <g>
                            <rect id="svg_2" fill="url(#blackgraright)" height="100%" width="100%"/>
                        </g>
                    </svg>
                </div>
            </div>

            <!-- main content of the page -->
            <div class="container">
                <main style="margin: 0">
                    <div id="app" class="section container">
<!-- LC 2019-10-2 -->
  <p class="flow-text">
    <em>Please input the type of reverse transcriptase that you want to use:</em><br/>
    <input type="radio" name="rev" value="MMLV" id="rev_MMLV" checked /><label for="rev_MMLV">MMLV</label><br/>
    <input type="radio" name="rev" value="HIV1" id="rev_HIV1" /><label for="rev_HIV1">HIV1</label><br/>
    <input type="radio" name="rev" value="RSV" id="rev_RSV" /><label for="rev_RSV">RSV</label>
  </p>
  <p class="flow-text">
    <em>Please input a sequence that you want to mutate:</em><br/>
    <input type="text" name="target" size="60" id="target_seq" value="" />
  </p>
  <p>
    <input type="submit" value="submit" id="submit" />
    <input type="submit" value="clear" id="clear" />
    <input type="submit" value="demo" id="demo" style="float:right" />
  </p>
  <p id="progress" style="background:yellow;font-size:0.75em;line-height:11pt;text-indent:-10px;padding-left:15px"></p>
  <div><table id="table_result" style="background-color:#eee"></table></div>
  <hr/>
  <p id="p_primer" style="color:green" class="flow-text Off">
    <em>Your tRNA primer:</em><br/>
    5'-<span id="primer_seq"></span>-3'
  </p>
  <script>
var DEBUG = false,
    Max_Mismatch = 2,
    temp_seq = 'GGCUCGUUGGUCUAGGGGUAUGAUUCUCGCUUAGGGUGCGAGAGGUCCCGGGUUCAAAUCCCGGACGAGCCCCCA',
    PBS_len = 18;

function getQueryStringArgs() {
  var qs = location.search.length > 0 ? location.search.substring(1) : '',
      args = {},
      items = qs.length ? qs.split('&') : [],
      item = null,
      name = null,
      value = null,
      i = 0,
      len = items.length;
  for (i = 0; i < len; i += 1) {
    item = items[i].split('=');
    name = decodeURIComponent(item[0]);
    value = decodeURIComponent(item[1]);
    if (name.length) {
      args[name] = value;
    }
  }
  return args;
}

function cumsum(myarray) {
  var new_array = [];
  myarray.reduce(function(a,b,i) { return new_array[i] = a+b; }, 0);
  return new_array;
}

function complement(ele) {
    if (ele === 'A') {
      return 'U';
    } else if (ele === 'U' || ele === 'T') {
      return 'A';
    } else if (ele === 'G') {
      return 'C';
    } else if (ele === 'C') {
      return 'G';
    }
  return 'N';
}
function complement_dna(ele) {
    if (ele === 'A') {
      return 'T';
    } else if (ele === 'T' || ele === 'U') {
      return 'A';
    } else if (ele === 'G') {
      return 'C';
    } else if (ele === 'C') {
      return 'G';
    }
  return 'N';
}

function isComplement(Base1, Base2, drawMode, alignMode) {
  if (!drawMode) { drawMode = 'none'; }
  if (!alignMode) { alignMode = 'none'; }
  if (Base1 == complement(Base2)) {
    if (alignMode === 'vertical') {
      return 3;
    } else {
      return 1;
    }
  } else if ( (Base1 === 'G' && Base2 === 'U') ||
              (Base1 === 'U' && Base2 === 'G') ) {
    if (drawMode === 'draw') {
      return 2;
    } else {
      return 1;
    }
  } else {
    return 0;
  }      
}

function anti_parallel(t) {
  var apt_list = [],
      t_list = t.split('');
  $.each(t_list, function (iV, ele) {
    if (ele === 'A') {
      apt_list.unshift( 'U' );
    } else if (ele === 'T' || ele === 'U') {
      apt_list.unshift( 'A' );
    } else if (ele === 'G') {
      apt_list.unshift( 'C' );
    } else if (ele === 'C') {
      apt_list.unshift( 'G' );
    }
  });
  return apt_list.join('');
}

function complementSeq(t) {
  var cs_list = [],
      t_list = t.split('');
  $.each(t_list, function (iV, ele) {
    cs_list.push( complement(ele) );
  });
  return cs_list.join('');
}
function complementSeq_dna(t) {
  var cs_list = [],
      t_list = t.split('');
  $.each(t_list, function (iV, ele) {
    cs_list.push( complement_dna(ele) );
  });
  return cs_list.join('');
}

function reverseAB(t, A, B) {
  if (A <= B || A >= t.length) { return ''; }
  var tt = '';
  for (let step = A; step > B; step--) {
      tt += t.substr(step, 1);
  }
  return tt;
}

function findRegion(seq, L) {
  var new_s = {};
  // return the basic components of tRNA (e.g. TArm, TLoop, etc.) for subsequent plotting step
  var S, Base1, Base2, mismatch1, mismatch2, mismatch3, MisMatch_total,
      AcptStemStart, AcptStemEnd, AcptStemLen,
      DLoopStart, DLoopEnd, DLoopLen,
      AtCLoopEnd, AtCLoopStart, AtCLoopStemLen,
      TArmSiteStart, TArmSiteEnd, TArmStemLen;
  for (let n = 0; n < L; n++) {
    for (let interval = 69; interval < 94; interval++) {
            AcptStemStart = n;
            AcptStemEnd = n + interval;
            AcptStemLen = 7;
            MisMatch_total = 0;
            if (AcptStemEnd >= L) { continue; }
            mismatch1 = 0;
            S = 0;
            for (let i = 0; i < AcptStemLen; i++) {
                Base1 = seq.substr(AcptStemStart+i, 1);
                Base2 = seq.substr(AcptStemEnd-i, 1);
                S += isComplement(Base1, Base2);
            }
            mismatch1 += (AcptStemLen - S);
            if (S < AcptStemLen-Max_Mismatch || mismatch1 > Max_Mismatch) { continue; }
            TArmSiteEnd = n + interval - AcptStemLen;
            TArmSiteStart = TArmSiteEnd - 16;
            TArmStemLen = 5;
            S = 0;
            for (let i = 0; i < TArmStemLen; i++) {
                Base1 = seq.substr(TArmSiteStart+i, 1);
                Base2 = seq.substr(TArmSiteEnd-i, 1);
                S += isComplement(Base1, Base2);
            }
            mismatch1 += (TArmStemLen - S);
            MisMatch_total = mismatch1;
            if (S < 4 || MisMatch_total > Max_Mismatch) { continue; }
            for (let DLoopLen = 14; DLoopLen < 19; DLoopLen++) {
                MisMatch_total = mismatch1;
                DLoopStart = n + 9;
                DLoopEnd = DLoopStart + DLoopLen;
                S = 0;
                if (DLoopLen < 17) { DLoopStemLen = 3; }
                else { DLoopStemLen = 4; }
                for (let i = 0; i < DLoopStemLen; i++) {
                    Base1 = seq.substr(DLoopStart+i, 1);
                    Base2 = seq.substr(DLoopEnd-i, 1);
                    S += isComplement(Base1, Base2);
                }
                mismatch2 = DLoopStemLen - S;
                MisMatch_total += mismatch2;
                if (MisMatch_total <= Max_Mismatch) {
                    AtCLoopStart = DLoopEnd + 2;
                    AtCLoopStemLen = 5;
                    for (let AtCLoopEnd = Math.max(AtCLoopStart+16, AcptStemEnd-54);
                         AtCLoopEnd <= Math.min(AtCLoopStart+16, AcptStemEnd-28); AtCLoopEnd++) {
                        S = 0;
                        MisMatch_total = mismatch1 + mismatch2;
                        for (let i = 0; i < AtCLoopStemLen; i++) {
                            Base1 = seq.substr(AtCLoopStart+i, 1);
                            Base2 = seq.substr(AtCLoopEnd-i, 1);
                            S += isComplement(Base1, Base2);
                        }
                        mismatch3 = AtCLoopStemLen - S;
                        MisMatch_total += mismatch3;
                        if (MisMatch_total <= Max_Mismatch) {
                            $('#progress').append('<br/>'+(AcptStemStart+1)+'..'+(AcptStemEnd+1+1)+'&nbsp;&nbsp;&nbsp;&nbsp;');
                            $('#progress').append('mismatch='+MisMatch_total+'\n');
                            GroupNum = [AcptStemStart, AcptStemLen, 2, 4, DLoopLen-2*4+1, 4, 1, AtCLoopStemLen,
                                        AtCLoopEnd-AtCLoopStart-2*AtCLoopStemLen+1, AtCLoopStemLen,
                                        TArmSiteStart-AtCLoopEnd-1, TArmStemLen, 16-2*TArmStemLen+1,
                                        TArmStemLen, AcptStemLen, seq.length-AcptStemLen];
                            GroupNum = cumsum(GroupNum);
                            new_s = {
                                AcceptArm: '',
                                Interval1: '',
                                DArm: '',
                                DLoop: '',
                                DArmComp: '',
                                Interval2: '',
                                AnticodonArm: '',
                                AnticodonLoop: '',
                                AnticodonArmComp: '',
                                VariableLoop: '',
                                TArm: '',
                                TLoop: '',
                                TArmComp: '',
                                AcceptArmComp: '',
                                Redundance:''
                            };
                            OutputName = [
                                'AcceptArm',
                                'Interval1',
                                'DArm',
                                'DLoop',
                                'DArmComp',
                                'Interval2',
                                'AnticodonArm',
                                'AnticodonLoop',
                                'AnticodonArmComp',
                                'VariableLoop',
                                'TArm',
                                'TLoop',
                                'TArmComp',
                                'AcceptArmComp',
                                'Redundance'
                            ];
                            for (let i  = AcptStemStart; i < L; i++) {
                                for (let j = 0; j < 15; j++) {
                                    if (i >= GroupNum[j] && i < GroupNum[j+1]) {
                                        new_s[OutputName[j]] += seq.substr(i, 1);
                                    }
                                }
                            }
                            DEBUG && console.log(new_s);
                            return new_s;
                        }
                    } // for AtCLoopEnd
                }
            } // for DLoopLen
    } // for interval
  } // for n
  $('#progress').text('!! not a tRNA, failed to draw');
  return new_s;
}

function linkerDtm(seq1, seq2, mode) {
  var linkSymbol = [' ', '-', '+', '|'],
      L1 = seq1.length,
      L2 = seq2.length, L, linkerSeq = '';
  if (L1 != L2) {
    return 0;
  } else {
    L = L1;
  }
  for (let i = 0; i < L; i++){
    Base1 = seq1.substr(i, 1);
    Base2 = seq2.substr(L-1-i, 1);
    linkerSeq += linkSymbol[ isComplement(Base1, Base2, 'draw', mode) ];
  }   
  return linkerSeq;
}

function draw_tRNA(ForDraw, preId) {
    var linker = {}, pre;
    if (ForDraw.DLoop.length < 9) {
        for (let i = 0; i < (9 - ForDraw.DLoop.length); i++) {
          ForDraw.DLoop += ' ';
        }
    }
    pre = '                        ' + ForDraw.Redundance + '\n';
    linker['AcceptorArmLink'] = linkerDtm(ForDraw.AcceptArm, ForDraw.AcceptArmComp)
    linker['DArmLink'] = linkerDtm(ForDraw.DArmComp,ForDraw.DArm, 'vertical')
    linker['AnticodonArmLink'] = linkerDtm(ForDraw.AnticodonArm, ForDraw.AnticodonArmComp)
    linker['TArmLink'] = linkerDtm(ForDraw.TArm, ForDraw.TArmComp, 'vertical')
    for (let i = 0; i < ForDraw.AcceptArm.length-1; i++) {
        pre += '                   ' + ForDraw.AcceptArm[i] +
               ' ' + linker.AcceptorArmLink[i] + ' ' +
               ForDraw.AcceptArmComp[ForDraw.AcceptArm.length-1-i] + '\n';
    }
    pre += '                   ' + ForDraw.AcceptArm[ForDraw.AcceptArm.length-1] +
           ' ' + linker.AcceptorArmLink[ForDraw.AcceptArm.length-1] +
           ' ' + ForDraw.AcceptArmComp[0] +
           '          ' + ForDraw.TLoop[6] + ' ' + ForDraw.TLoop[5]+ '\n';
    pre += '                  ' + ForDraw.Interval1[0] + '     ' +
           ForDraw.TArmComp[4] + ' ' +
           ForDraw.TArmComp[3] + ' ' +
           ForDraw.TArmComp[2] + ' ' +
           ForDraw.TArmComp[1] + ' ' +
           ForDraw.TArmComp[0] + '     ' + ForDraw.TLoop[4]+ '\n';
    pre += '      ' + ForDraw.DLoop[1] + ' ' + ForDraw.DLoop[0] +
           '        ' + ForDraw.Interval1[1] +
           '      ' + linker.TArmLink[0] + ' ' +
           linker.TArmLink[1] + ' ' +
           linker.TArmLink[2] + ' ' +
           linker.TArmLink[3] + ' ' +
           linker.TArmLink[4] + '     ' + ForDraw.TLoop[3]+ '\n';
    pre += '    ' + ForDraw.DLoop[2] + '     ' +
           ForDraw.DArm[3] + ' ' +
           ForDraw.DArm[2] + ' ' +
           ForDraw.DArm[1] + ' ' +
           ForDraw.DArm[0] + '       ' +
           ForDraw.TArm[0] + ' ' +
           ForDraw.TArm[1] + ' ' +
           ForDraw.TArm[2] + ' ' +
           ForDraw.TArm[3] + ' ' +
           ForDraw.TArm[4] + '     ' + ForDraw.TLoop[2]+ '\n';
    pre += '    ' + ForDraw.DLoop[3] + '     ' +
           linker.DArmLink[0] + ' ' +
           linker.DArmLink[1] + ' ' +
           linker.DArmLink[2] + ' ' +
           linker.DArmLink[3] + '                 ' +
           ForDraw.TLoop[1] + ' ' + ForDraw.TLoop[0]+ '\n';
    pre += '    ' + ForDraw.DLoop[4] + '     '+
           ForDraw.DArmComp[0] + ' ' +
           ForDraw.DArmComp[1] + ' ' +
           ForDraw.DArmComp[2] + ' ' + ForDraw.DArmComp[3]+ '\n';
    pre += '      ' + ForDraw.DLoop[6] + ' ' + ForDraw.DLoop[7] +
           '        ' + ForDraw.Interval2 +
           '     ' + ForDraw.VariableLoop+ '\n';
    for (let i = 0; i < ForDraw.AnticodonArm.length; i++) {
        pre += '                  ' + ForDraw.AnticodonArm[i] +
               ' ' + linker.AnticodonArmLink[i] + ' ' +
               ForDraw.AnticodonArmComp[ForDraw.AnticodonArm.length-1-i] + '\n';
    }
    pre += '                ' + ForDraw.AnticodonLoop[0] + '       ' + ForDraw.AnticodonLoop[6] + '\n';
    pre += '                ' + ForDraw.AnticodonLoop[1] + '       ' + ForDraw.AnticodonLoop[5] + '\n';
    pre += '                  ' + ForDraw.AnticodonLoop[2] +
           ' ' + ForDraw.AnticodonLoop[3] + ' ' + ForDraw.AnticodonLoop[4];
    $('#'+preId).text(pre);
}

function tRNA_primer(std_q) {
  var PBS = reverseAB(std_q, std_q.length-1, std_q.length-PBS_len-1);
  var Primerseq = complementSeq(PBS);
  var temp = findRegion( temp_seq.replace('T','U'), temp_seq.length );
  if (temp) {
    // tRNA_Pro for MMLV RT, tRNA_Lys for HIV-1 RT, tRNA_Trp for RSV RT
    $('#table_result').html('<tr><th>Template for ' + $('input[name="rev"]:checked').val() + '</th><th>Your tRNA</th></tr>' +
                            '<tr><td><pre id="preLeft"></pre></td><td><pre id="preRight"></pre></td></tr>');
  }
  draw_tRNA(temp, 'preLeft');
  var qT = temp;
  qT.Redundance = reverseAB(Primerseq, qT.Redundance.length-1, -1);
  qT.AcceptArmComp = reverseAB(Primerseq,
                               qT.Redundance.length+qT.AcceptArmComp.length-1, qT.Redundance.length-1);
  qT.AcceptArm = anti_parallel(qT.AcceptArmComp);
  qT.TArmComp = reverseAB(Primerseq.substr(qT.Redundance.length+qT.AcceptArmComp.length, 5), 4, -1);
  qT.TArm = anti_parallel(qT.TArmComp);
  var remainNotR = Primerseq.substr(qT.TArmComp.length+qT.Redundance.length+qT.AcceptArmComp.length);
  qT.TLoop = qT.TLoop.substr(0, qT.TLoop.length-remainNotR.length) + reverseAB(remainNotR, remainNotR.length-1, -1);
  draw_tRNA(qT, 'preRight');
  return complementSeq_dna( qT.AcceptArm + qT.Interval1 + qT.DArm + qT.DArmComp + qT.Interval2 +
                            qT.AnticodonArm + qT.AnticodonLoop + qT.VariableLoop + qT.TArm +
                            qT.TLoop + qT.TArmComp + qT.AcceptArmComp + qT.Redundance );
}

function clean_results() {
  $('#progress').text('');
  $('#table_result').html('');
  $('#graph_result').html('');
  $('#primer_seq').text('');
  $('#p_primer').addClass('Off');
}


$(document).ready(function () {
  $('#submit').on('click', function (event) {
    clean_results();
    var q = $('#target_seq').val();
    if (q) {
      std_q = q.replace(/[^atgc]/gi, '').toUpperCase();
      DEBUG && $('#progress').text('Input: ' + std_q);
      if (std_q && std_q.length >= PBS_len) {
        $('#primer_seq').text(tRNA_primer( std_q ));
        $('#p_primer').removeClass('Off');
        DEBUG || $('#progress').addClass('Off');
      } else {
        $('#progress').text('!! the sequence should be longer');
        $('#target_seq').focus();
      }
    } else {
      $('#progress').text('!! please input something');
      $('#target_seq').focus();
    }
    event.preventDefault();
  });

  var r = getQueryStringArgs();
  if (r.seq) {
    var q = r.seq;
    $('#target_seq').val(r.seq);
    std_q = t.replace(/[^atgc]/gi, '').toUpperCase();
    //plus_strand_search(s, std_q);
  }

  $('#clear').on('click', function (event) {
    clean_results();
    $('#target_seq').val('');
    $('#rev_MMLV').prop('checked', true);
    temp_seq = 'GGCUCGUUGGUCUAGGGGUAUGAUUCUCGCUUAGGGUGCGAGAGGUCCCGGGUUCAAAUCCCGGACGAGCCCCCA';
    PBS_len = 18;
    event.preventDefault();
  });

  $('#demo').on('click', function (event) {
    clean_results();
    var q = 'CGATGATCGATCAGCTAGCTAGTCGATCGATCGATC';
    $('#target_seq').val(q);
    $('#primer_seq').text(tRNA_primer( q ));
    $('#p_primer').removeClass('Off');
    DEBUG || $('#progress').addClass('Off');
    event.preventDefault();
  });

  $('input[name="rev"]').on('change', function () {
    if (this.checked) {
      clean_results();
      if (this.value === 'MMLV') {
        DEBUG && $('#progress').text('MMLV');
        temp_seq = 'GGCUCGUUGGUCUAGGGGUAUGAUUCUCGCUUAGGGUGCGAGAGGUCCCGGGUUCAAAUCCCGGACGAGCCCCCA';
        PBS_len = 18;
      } else if (this.value === 'HIV1') {
        DEBUG && $('#progress').text('HIV1');
        temp_seq = 'GCCCGGCUAGCUCAGDCGGDAGAGCAUCAGACUUUUAAUCUGAGGGDCCAGGGTUCAAGUCCCUGUUCGGGCGCCA';
        PBS_len = 18;
      } else if (this.value === 'RSV') {
        DEBUG && $('#progress').text('RSV');
        temp_seq = 'GACCUCGUGGCGCAACGGDAGCGCGUCUGACUCCAGAUCAGAAGGCUGCGUGUUCGAAUCACGUCGGGGUCACCA';
        PBS_len = 17;
      } else {
        $('#progress').text('This type of reverse transcriptase is not supported.');
      }
    }
  });
});
  </script>
<!-- LC 2019-10-2 -->
                    </div>

                    <div id="explained" class="section container">
                        <h2>How to
                        </h2>
                        <p class="flow-text">
                            Modeling is necessary for quantifying biological processes and designing biological systems for customized function. With the increasingly rapid development of synthetic biology, many models are based on different branches of applied mathematics, as exampled by stochastic process, cellular automaton, dynamic systems, and Boltzmann kinetics for different biological processes. For example, automaton is often used to model birth and death processes, stochastic processes is often used to model transcription factor-DNA binding，dynamic systems is often used in population ecology to predict the evolution of colony, and Boltzmann kinetics is often used to quantitatively describe chemical reactions. Some toolkit based on this model, like <a href="http://www.compucell3d.org/" target=_blank>CompCell3D</a>, has been developed for computational nanotechnology and simulating tissue development.
                        </p>
                        <p class="flow-text">
                            However, there hasn’t a ready single model for our ENABLE project. It is because an overall model for our project should not only consist the 3-layer standard design (for more details please visit <a href="/Team:Fudan-TSI/Results">our Results page</a>) but also the biological mechanism underlying it (for more details please visit <a href="/Team:Fudan-TSI/Model">our Modeling page</a>).
                        </p>
                        <p class="flow-text">
                            Here we present a software (<a href="https://github.com/0vioiano/iGEM2018_Team_Fudan" target=_blank>github.com/0vioiano/iGEM2018_Team_Fudan</a>) using multiscale mathematical tools for different biological processes, which serves as a reusable tool for cell colony design. We use different modules packaged in different <i>Classes</i> to simulate different biological processes. Based on the object-oriented principal, it is easy for users to realize customized Classes and simulate cell colony using our software.
                        </p>
                        <p class="flow-text">
                            A colony is occupied by different populations, a population is unitized by abundant individuals, be it a cell or an ensemble of various cells, and a cell is a network of chemicals, for example, proteins, lipids, nucleotides, etc. To simulate cell colony, our software bridges a nanoscopic transcriptional design of biological circuits, with microscopic cellular behaviors, up to a macroscopic population output, from which clinical outcome could be predicted, artificial tissue could be assembled, etc.
                        </p>
                        <p class="flow-text">
                            A demonstration using our software to simulate the process of our engineered cells collaborating to wipe out cancer cells are offered as <a href="https://github.com/0vioiano/iGEM2018_Team_Fudan/tree/master/demo" target=_blank>a demo</a>.
                        </p>
                    </div>
                </main>
            </div>
            <!-- end of main content of the page -->

<!--Abstract on content page-->
            <div id="abstractContent" class="z-depth-2">
                <a href="#!"><img alt="project summary" src="https://2018.igem.org/wiki/images/9/96/T--Fudan--X.svg"></a>
                <div class="container">
                    <h5 style="margin:0;padding:10px 0;">Project Summary &copy; Team:Fudan-TSI</h5>
                    <p class="flow-text" style="margin:0">Mutation library generation is critical for biological and medical research, but current methods cannot mutate a specific sequence continuously without manual intervention. Here we present a toolbox for <i>in vivo</i> continuous mutation library construction. First, the target DNA is transcribed into RNA. Next, our reverse transcriptase reverts RNA into cDNA, during which the target is randomly mutated by enhanced error-prone reverse transcription. Finally, the mutated version replaces the original sequence through recombination. These steps will be carried out iteratively, generating a random mutation library of the target with high efficiency as mutations accumulate along with bacterial growth. Our toolbox is orthogonal and provides a wide range of applications among various species. R-Evolution could mutate coding sequences and regulatory sequences, which enables the <i>in vivo</i> evolution of individual proteins or multiple targets at a time, promotes high-throughput research, and serves as a foundational advance to synthetic biology.
                    </p>
                </div>
            </div>

            <!-- Floating Btns -->
            <div class="floatingBtn">
                <a href="#!" id="abstractBtn" class="btn">
                    <i class="fa fa-sticky-note" style="font-size:30px;line-height:50px"></i>
                </a>
                <a href="#FudanWrapper" class="btn">
                    <i class="fa fa-angle-up" style="font-size:48px;line-height:45px"></i>
                </a>
            </div>

            <!-- Footer with sponsors and contact methods -->
            <footer id="FudanFooter" class="page-footer grey">
                <div class="container">
                    <div class="row">
                        <div id="sponsor" class="col m3 s12 row">
                            <a href="https://2019.igem.org/Team:Fudan-TSI"><img alt="2018 Team:Fudan logo white" class="col s3 m6 l3" style="position:relative; padding: 0.5em 0.3rem; margin:-0.15rem 0; left: -0.45rem;" src="https://2019.igem.org/wiki/images/7/7f/T--Fudan-TSI--Logo0-crop-grey.png">
                            </a><a href="http://www.fudan.edu.cn/en/" target="_blank"><img class="col s3 m6 l3" alt="Fudan University" src="https://2018.igem.org/wiki/images/f/f7/T--Fudan--schoolLogo.png">
                        </a><a href="http://life.fudan.edu.cn/" target="_blank"><img class="col s3 m6 l3" style="margin-bottom: 4%;/* 该图比其他小一点，排版需要 */" alt="School of Life Sciences, Fudan University" src="https://2018.igem.org/wiki/images/1/1d/T--Fudan--schoolOfLifeSciencesIcon.png">
                        </a><a href="http://www.yfc.cn/en/" target="_blank"><img class="col s3 m6 l3" style="padding: 0.15rem 0.9rem;" alt="Yunfeng Capital" src="https://2018.igem.org/wiki/images/e/e2/T--Fudan--yunfengLogo.png">
                        </a>
                            <h3 class="col s12" style="text-align: left; color: rgba(255, 255, 255, 0.8); font-size:12.5px">R-Evolution: an <i>in vivo</i> sequence-specific toolbox for continuous mutagenesis</h3>
                        </div>
                        <div id="usefulLinks" class="col m9 s12 row">
                            <div class="col s12 l6 row">
                                <div class="col s12 m4">
                                  <span><a href="/Team:Fudan-TSI/Description">Project</a></span>
                                    <ul>
                                        <li><a href="/Team:Fudan-TSI/Description">Background</a></li>
                                        <li><a href="/Team:Fudan-TSI/Design">Design</a></li>
                                        <li><a href="/Team:Fudan-TSI/Experiments">Experiments</a></li>
                                        <li><a href="/Team:Fudan-TSI/Judging">Judging</a></li>
                                    </ul>
                                </div>
                                <div class="col s12 m4">
                                    <span><a href="/Team:Fudan-TSI/Results">Results</a></span>
                                    <ul>
                                        <li><a href="/Team:Fudan-TSI/Results#ReverseTranscription">Reverse Transcription</a></li>
                                        <li><a href="/Team:Fudan-TSI/Results#Recombination">Recombination</a></li>
                                        <li><a href="/Team:Fudan-TSI/Demonstrate">Demonstration</a></li>
                                        <li><a href="/Team:Fudan-TSI/Measurement">Measurement</a></li>
                                        <li><a href="/Team:Fudan-TSI/Notebook">Notebook</a></li>
                                    </ul>
                                </div>
                                <div class="col s12 m4 active">
                                    <span><a href="/Team:Fudan-TSI/Model">Model</a></span>
                                    <ul>
                                        <li><a href="/Team:Fudan-TSI/Model">Modeling</a></li>
                                        <li><a href="/Team:Fudan-TSI/Software">Software</a></li>
                                        <li><a href="/Team:Fudan-TSI/Hardware">Hardware</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col s12 l6 row">
                                <div class="col s12 m4">
                                  <span><a href="/Team:Fudan-TSI/Parts">Parts</a></span>
                                    <ul>
                                        <li><a href="/Team:Fudan-TSI/Parts#BasicPart">Basic parts</a></li>
                                        <li><a href="/Team:Fudan-TSI/Parts#CompositePart">Composite parts</a></li>
                                        <li><a href="/Team:Fudan-TSI/Improve">Improved parts</a></li>
                                        <li><a href="/Team:Fudan-TSI/Parts#PartCollection">Part collection</a></li>
                                    </ul>
                                </div>
                                <div class="col s12 m4">
                                  <span><a href="/Team:Fudan-TSI/Human_Practices">Outreach</a></span>
                                    <ul>
                                        <li><a href="/Team:Fudan-TSI/Public_Engagement">Education &amp; Public engagement</a></li>
                                        <li><a href="/Team:Fudan-TSI/Human_Practices#IntegratedHumanPractice">Integrated human practice</a></li>
                                        <li><a href="/Team:Fudan-TSI/Collaborations">Collaborations</a></li>
                                        <li><a href="/Team:Fudan-TSI/Safety">Safety</a></li>
                                    </ul>
                                </div>
                                <div class="col s12 m4">
                                  <span><a href="/Team:Fudan-TSI/Team">Team</a></span>
                                    <ul>
                                        <li><a href="/Team:Fudan-TSI/Team">Members</a></li>
                                        <li><a href="/Team:Fudan-TSI/Attributions">Attributions</a></li>
                                        <li><a href="http://2018.igem.org/Team:Fudan/Heritage" target=_blank>Heritage</a></li>
                                        <li><a href="/Team:Fudan-TSI">&copy; 2019</a></li>
                                    </ul>
                                </div>
                                <div class="col s12 m4">&nbsp;</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer-copyright">
                    <div class="container">
                         <div class="contactUS row">
                           <div class="col s12 m6 l4"><i class="fa fa-location-arrow"></i> Life Sci Bldg, 2005 Songhu Rd, Shanghai
                           </div><div class="col s12 m6 l2"><i class="fa fa-fax"></i> +86-21-31246727
                           </div><div class="col s12 m6 l2"><i class="fa fa-envelope-o"></i> igem@fudan.edu.cn
                           </div><div class="col s12 m6 l4"><i class="fa fa-twitter"></i> <i class="fa fa-wechat"></i> Fudan_iGEM
                           </div>
                         </div>
                     </div>
                </div>
            </footer>

        </div>
    </div>
</div>


<!-- Javascript files -->
<!-- Materialize 1.0.0-rc.2 -->
<script src="/Template materialize.js"></script>

<!-- Javascript -->
<script src="/Template Fudan-js.js"></script>

</body>
</html>